- javascript为什么是单线程？知道event loop吗？实现一个

javascript可以操作DOM，如果不是单线程的，当有两个或以上线程操作同一个DOM时，浏览器没法判断应该采用哪个线程的结果。

```js
function eventLoop() {
  const taskArr = [];
  while (true) {
    if (taskArr.length) {
      const curTask = taskArr.shift();
      curTask();
    }
  }
}

```

- 介绍浏览器事件循环

JS在浏览器中的执行是单线程的。若所有事件方法都以同步的方式在主线程中运行，则进程会因为等待耗时任务的执行而被阻塞，效率很低。

为了协调事件，用户交互，脚本，渲染，网络、用户代理等，必须使用事件循环。事件循环是解决JS单线程运行阻塞的一种机制。

事件循环的主要机制是任务队列机制。

浏览器维持有一个或多个任务队列，当主线程的任务执行完毕后，就去任务队列中查询是否有待执行的任务，若有则取出任务到主线程执行，若没有，则间隔一段时间后再访问任务队列。

在调用任务执行的过程中，会产生新的任务，浏览器就会不断的执行任务，因此成为事件循环。

1. 所有的「同步任务」都在主线程进行

2. 「异步任务」进入任务队列，任务队列会通知主线程，哪个异步任务可以执行，这个异步任务就会进入主线程。异步任务必须指定回调函数，当主线程开始执行异步任务，其实就是在执行对应的回调函数。

3. 如果主线程的所有同步任务都执行完，系统就会去读取「任务队列」上的异步任务，如果有可以执行的，就会结束等待状态，进入主线程，开始执行。

4. 主线程不断的执行第3步

- 哪些是宏任务，哪些是微任务

宏任务: script,setTimeout,setInterval,同步任务,setImmediate(Node),I/O操作,UI渲染

微任务: promise.then,process.nextTick(Node),MutationObserver回调(浏览器端),Object.observe

<span style="color: red;font-size: 18px;">process.nextTick</span>的优先级在微任务队列中是最高的