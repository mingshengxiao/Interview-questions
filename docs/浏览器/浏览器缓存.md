### 浏览器获取缓存的流程为:

1. 先根据这个资源的一些 http header 判断它是否命中强缓存，如果命中，则直接从本地获取缓存资源，不会发请求到服务器；
2. 当强缓存没有命中时，客户端会发送请求到服务器，服务器通过另一些 request header 验证这个资源是否命中协商缓存，称为 http 再验证，如果命中，服务器将请求返回，但不返回资源，而是告诉客户端直接从缓存中获取，客户端收到返回后就会从缓存中获取资源；
3. 强缓存和协商缓存共同之处在于，如果命中缓存，服务器都不会返回资源；区别是，强缓存不对发送请求到服务器，但协商缓存会。

当协商缓存也没命中时，服务器就会将资源发送回客户端。

当 ctrl+f5 强制刷新网页时，直接从服务器加载，跳过强缓存和协商缓存；

当 f5 刷新网页时，跳过强缓存，但是会检查协商缓存；

### 强缓存相关的字段

- Expires

该字段是 `http1.0` 时的规范，值为一个绝对时间的 GMT 格式的时间字符串，代表缓存资源的过期时间

- Cache-Control

该字段是 `http1.1`的规范，强缓存利用其 max-age 值来判断缓存资源的最大生命周期，它的值单位为秒

常用的指令有:

1. **no-cache**:不使用本地缓存。需要使用缓存协商，先与服务器确认返回的响应是否被更改，如果之前的响应中存在 ETag，那么请求的时候会与服务端验证，如果资源未被更改，则可以避免重新下载。
2. **no-store**:直接禁止游览器缓存数据，每次用户请求该资源，都会向服务器发送一个请求，每次都会下载完整的资源。
3. **public**:可以被所有的用户缓存，包括终端用户和 CDN 等中间代理服务器。
4. **private**:只能被终端用户的浏览器缓存，不允许 CDN 等中继缓存服务器对其缓存。
5. **max-age**:指示客户机可以接收生存期不大于指定时间（以秒为单位）的响应。

Expires 是一个绝对时间，表示到达该时间时缓存过期，与用户本地的时间有关系，而本地时间是可以改的，会产生与服务器生成的过期时间不一致问题；

Cache-Control 表示的是一个相对时间，指从当前时间后的 max-age 时缓存过期。

### 协商缓存相关的字段

- Last-Modified

值为资源最后更新时间，随服务器 response 返回，即使文件改回去，日期也会变化

- If-Modified-Since

通过比较两个时间来判断资源在两次请求期间是否有过修改，如果没有修改，则命中协商缓存

- ETag

表示资源内容的唯一标识，随服务器 response 返回，仅根据文件内容是否变化判断

- If-None-Match

服务器通过比较请求头部的 If-None-Match 与当前资源的 ETag 是否一致来判断资源是否在两次请求之间有过修改，如果没有修改，则命中协商缓存

通常是 Last-Modified/If-Modified-Since 和 ETag/If-None-Match 配套使用。
